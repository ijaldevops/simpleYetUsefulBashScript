#!/bin/sh
echo "=============================================================================================================================================="
echo `date`
echo "=============================================================================================================================================="
touch /var/log/checkepgmem.log


#ps aux  | awk '{print $6/1024  " MB\t\t" $2 "\t" $11}'  | egrep -v '0 MB' | sort -r
ps aux  | awk -v date="$(date +%Y-%m-%d-%H-%M-%S)" '{print date" >> " $6/1024    " MB\t\t" $2 "\t" $11}' | egrep -v '0 MB' | sort -r | egrep -v '>> 0.' 

echo "--------------------"
free -m
echo "--------------------"
sar -r 1 1
echo "=============================================================================================================================================="

